include ../Makefile.inc

# detect what platform we're building on
$(shell ./build_detect_platform build_config.mk)
# this file is generated by the previous line to set build flags and sources
include build_config.mk

CFLAGS += -iquote ..
LIBS = ../common.a $(LEVELDBLIBRARY)
LDFLAGS += `pkg-config fuse --libs`

metadb_fs.o : metadb_fs.c operations.h
	$(CC) $(CFLAGS) -c metadb_fs.c

rpc_fs.o : rpc_fs.c operations.h
	$(CC) $(CFLAGS) -c local_fs.c
						
local_fs.o : local_fs.c operations.h
	$(CC) $(CFLAGS) -c local_fs.c
						

metadb_fs_test.o : metadb_fs_test.c operations.h
	$(CC) $(CFLAGS) -c metadb_fs_test.c

metadb_fs_test : metadb_fs_test.o metadb_fs.o
	$(CC) -o $@ $^ $(LIBS) $(LDFLAGS)

metadb_fs_readdir_test.o : metadb_fs_readdir_test.c operations.h
	$(CC) $(CFLAGS) -c metadb_fs_readdir_test.c

metadb_fs_readdir_test : metadb_fs_readdir_test.o metadb_fs.o
	$(CC) -o $@ $^ $(LIBS) $(LDFLAGS)

metadb_insert_test.o : metadb_insert_test.c operations.h
	$(CC) $(CFLAGS) -c metadb_insert_test.c

metadb_insert_test : metadb_insert_test.o metadb_fs.o
	$(CC) -o $@ $^ $(LIBS) $(LDFLAGS)

metadb_stress_test.o : metadb_stress_test.c operations.h
	$(CC) $(CFLAGS) -c metadb_stress_test.c

metadb_fs_check.o : metadb_fs_check.c operations.h
	$(CC) $(CFLAGS) -c metadb_fs_check.c

metadb_stress_test : metadb_stress_test.o metadb_fs.o
	$(CC) -o $@ $^ $(LIBS) $(LDFLAGS)

metadb_split_test : metadb_split_test.o metadb_fs.o
	$(CC) -o $@ $^ $(LIBS) $(LDFLAGS)

metadb_stress_test_padding.o : metadb_stress_test_padding.c operations.h
	$(CC) $(CFLAGS) -c metadb_stress_test_padding.c

metadb_stress_test_padding: metadb_stress_test_padding.o metadb_fs.o
	$(CC) -o $@ $^ $(LIBS) $(LDFLAGS)

metadb_mix_test.o : metadb_mix_test.c operations.h
	$(CC) $(CFLAGS) -c metadb_mix_test.c

metadb_mix_test : metadb_mix_test.o metadb_fs.o
	$(CC) -o $@ $^ $(LIBS) $(LDFLAGS)

metadb_fs_check : metadb_fs_check.o metadb_fs.o
	$(CC) -o $@ $^ $(LIBS) $(LDFLAGS)

clean :
	rm -f *.o metadb_fs_test metadb_insert_test metadb_fs_readdir_test
